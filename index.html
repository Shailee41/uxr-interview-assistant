<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UX Interview Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'SF Pro Display', Roboto, sans-serif;
            background: linear-gradient(180deg, #f5e6f0 0%, #e8f0f7 50%, #fde8e8 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            color: #2d2d2d;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 20%, rgba(255, 182, 193, 0.15), transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(176, 196, 222, 0.15), transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 218, 224, 0.1), transparent 60%);
            animation: gradientShift 20s ease infinite;
            z-index: -1;
        }

        @keyframes gradientShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Screen Management */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Common Card Styles */
        .card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.9);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            margin-bottom: 24px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 600;
            color: #2d2d2d;
            margin-bottom: 12px;
            letter-spacing: -1px;
        }

        .header p {
            font-size: 1.1em;
            color: #666;
            line-height: 1.6;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 28px;
        }

        .form-group label {
            display: block;
            font-size: 1em;
            font-weight: 600;
            color: #2d2d2d;
            margin-bottom: 12px;
        }

        .form-group textarea,
        .form-group input {
            width: 100%;
            padding: 16px;
            font-size: 1em;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-family: inherit;
            background: rgba(255, 255, 255, 0.7);
            resize: vertical;
            transition: all 0.3s ease;
        }

        .form-group textarea:focus,
        .form-group input:focus {
            outline: none;
            border-color: #a855f7;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 0 4px rgba(168, 85, 247, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
        }

        /* Button Styles */
        .btn {
            padding: 16px 32px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(168, 85, 247, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(168, 85, 247, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #2d2d2d;
            border: 2px solid rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(0, 0, 0, 0.2);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(239, 68, 68, 0.4);
        }

        .btn-full {
            width: 100%;
        }

        /* Question Categories */
        .category {
            margin-bottom: 32px;
            padding: 24px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 16px;
            border: 2px solid rgba(0, 0, 0, 0.05);
        }

        .category-header {
            font-size: 1.3em;
            font-weight: 600;
            color: #2d2d2d;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
        }

        .question-item {
            padding: 16px;
            margin-bottom: 12px;
            background: white;
            border-radius: 12px;
            border: 2px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .question-item.removed {
            opacity: 0.4;
            text-decoration: line-through;
        }

        .question-text {
            flex: 1;
            font-size: 1em;
            color: #2d2d2d;
            line-height: 1.5;
        }

        .question-actions {
            display: flex;
            gap: 12px;
            margin-left: 16px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
        }

        /* Interview Screen Styles */
        .interview-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .interview-layout {
                grid-template-columns: 1fr;
            }
        }

        .transcript-box {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 16px;
            padding: 24px;
            height: 400px;
            overflow-y: auto;
            border: 2px solid rgba(0, 0, 0, 0.05);
        }

        .transcript-entry {
            margin-bottom: 16px;
            padding: 12px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #a855f7;
        }

        .transcript-speaker {
            font-weight: 600;
            color: #a855f7;
            margin-bottom: 4px;
        }

        .transcript-text {
            color: #2d2d2d;
            line-height: 1.5;
        }

        .status-indicator {
            padding: 12px 20px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.15);
            color: #059669;
            border: 2px solid rgba(16, 185, 129, 0.3);
        }

        .status-inactive {
            background: rgba(107, 114, 128, 0.15);
            color: #4b5563;
            border: 2px solid rgba(107, 114, 128, 0.3);
        }

        .suggestions-box {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 16px;
            padding: 24px;
            border: 2px solid rgba(0, 0, 0, 0.05);
        }

        .suggestions-box h3 {
            margin-bottom: 16px;
            font-size: 1.2em;
        }

        .suggestion {
            padding: 14px;
            margin-bottom: 12px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #ec4899;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .suggestion:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Summary Screen */
        .qa-item {
            margin-bottom: 28px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border-left: 4px solid #a855f7;
        }

        .qa-question {
            font-weight: 600;
            color: #2d2d2d;
            margin-bottom: 8px;
            font-size: 1.05em;
        }

        .qa-answer {
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .qa-category {
            display: inline-block;
            padding: 6px 14px;
            background: rgba(168, 85, 247, 0.15);
            color: #a855f7;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .insights-tags {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .insight-tag {
            padding: 6px 12px;
            background: rgba(236, 72, 153, 0.15);
            color: #ec4899;
            border-radius: 20px;
            font-size: 0.85em;
        }

        /* Report Screen */
        .report-content {
            background: white;
            padding: 40px;
            border-radius: 16px;
            line-height: 1.8;
        }

        .report-content h2 {
            color: #2d2d2d;
            margin-top: 32px;
            margin-bottom: 16px;
            font-size: 1.5em;
        }

        .report-content h2:first-child {
            margin-top: 0;
        }

        .report-content ul {
            margin-left: 24px;
            margin-bottom: 20px;
        }

        .report-content li {
            margin-bottom: 12px;
            color: #4b5563;
        }

        .report-content blockquote {
            margin: 20px 0;
            padding: 16px 24px;
            border-left: 4px solid #a855f7;
            background: rgba(168, 85, 247, 0.05);
            font-style: italic;
            color: #4b5563;
        }

        .report-content img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin: 24px 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            display: block;
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            margin-top: 24px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1em;
            color: #666;
        }

        .spinner {
            border: 4px solid rgba(168, 85, 247, 0.2);
            border-top: 4px solid #a855f7;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- SCREEN 1: Landing / Product Input -->
        <div id="screen-landing" class="screen active">
            <div class="header">
                <h1>üéØ UX Interview Assistant</h1>
                <p>Prepare for customer discovery interviews with AI-generated questions</p>
            </div>

            <div class="card">
                <div class="form-group">
                    <label for="product-description">üì¶ Product Description</label>
                    <textarea id="product-description" placeholder="Describe your product or feature. What does it do? Who is it for?

Example: We're building a meal planning app for busy professionals that helps them create weekly meal plans based on their dietary preferences and automatically generates shopping lists."></textarea>
                </div>

                <div class="form-group">
                    <label for="research-goals">üéØ Customer Discovery Goals</label>
                    <textarea id="research-goals" placeholder="What do you want to learn from this interview? What assumptions do you want to validate?

Example: We want to understand how busy professionals currently plan their meals, what pain points they face, and whether automated meal planning would save them time. We also want to validate if grocery list generation is a valuable feature."></textarea>
                </div>

                <button class="btn btn-primary btn-full" onclick="generateQuestions()" id="generate-btn">
                    ‚ú® Generate Interview Questions
                </button>
            </div>
        </div>

        <!-- SCREEN 2: Question Review -->
        <div id="screen-questions" class="screen">
            <div class="header">
                <h1>üìù Review Your Questions</h1>
                <p>Remove any questions you don't want to ask during the interview</p>
            </div>

            <div class="card">
                <div id="questions-container">
                    <!-- Questions will be loaded here -->
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="showScreen('screen-landing')">‚Üê Back</button>
                    <button class="btn btn-primary" onclick="startLiveMode()" style="flex: 1;">
                        üé§ Start Live Mode
                    </button>
                </div>
            </div>
        </div>

        <!-- SCREEN 3: Live Interview Mode -->
        <div id="screen-interview" class="screen">
            <div class="header">
                <h1>üéôÔ∏è Live Interview</h1>
                <p>Real-time transcription and AI-powered question suggestions</p>
            </div>

            <div class="card">
                <div id="listening-status" class="status-indicator status-inactive">
                    ‚è∏Ô∏è Not Recording
                </div>

                <div class="action-buttons" style="margin-bottom: 24px;">
                    <button class="btn btn-primary" onclick="startRecording()" id="record-btn">
                        üé§ Start Recording
                    </button>
                    <button class="btn btn-secondary" onclick="stopRecording()" id="stop-btn" disabled>
                        ‚èπÔ∏è Stop Recording
                    </button>
                </div>

                <div class="interview-layout">
                    <div>
                        <h3 style="margin-bottom: 16px;">Live Transcript</h3>
                        <div id="transcript-box" class="transcript-box">
                            <p style="color: #666; text-align: center; padding: 40px;">
                                Transcript will appear here once recording starts...
                            </p>
                        </div>
                    </div>

                    <div>
                        <div class="suggestions-box">
                            <h3>üí° AI Question Suggestions</h3>
                            <div id="suggestions-box">
                                <p style="color: #666;">Click "Generate Questions" to get AI suggestions</p>
                            </div>
                            <button class="btn btn-secondary btn-full" onclick="getSuggestions()" style="margin-top: 16px;">
                                üîÑ Generate Questions
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <script>
        // Global state
        let currentScreen = 'screen-landing';
        let generatedQuestions = [];
        let isRecording = false;
        let deepgramSocket = null;
        let mediaRecorder = null;
        let audioContext = null;
        let suggestionsInterval = null;
        let interviewData = null;
        let reportData = null;

        // Screen management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            currentScreen = screenId;
        }

        // SCREEN 1: Generate Questions
        async function generateQuestions() {
            const productDesc = document.getElementById('product-description').value.trim();
            const researchGoals = document.getElementById('research-goals').value.trim();

            if (!productDesc || !researchGoals) {
                alert('Please fill in both product description and research goals');
                return;
            }

            const btn = document.getElementById('generate-btn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Generating questions...';

            try {
                const response = await fetch('/generate-questions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        product_description: productDesc,
                        research_goals: researchGoals
                    })
                });

                const data = await response.json();
                generatedQuestions = data.categories;
                displayQuestions();
                showScreen('screen-questions');

            } catch (error) {
                console.error('Error generating questions:', error);
                alert('Error generating questions. Please try again.');
            } finally {
                btn.disabled = false;
                btn.textContent = '‚ú® Generate Interview Questions';
            }
        }

        // SCREEN 2: Display Questions
        function displayQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';

            generatedQuestions.forEach((category, catIndex) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                categoryDiv.innerHTML = `<div class="category-header">${category.name}</div>`;

                category.questions.forEach((q, qIndex) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-item' + (q.selected ? '' : ' removed');
                    questionDiv.innerHTML = `
                        <div class="question-text">${q.text}</div>
                        <div class="question-actions">
                            <button class="btn btn-secondary btn-small" onclick="toggleQuestion(${catIndex}, ${qIndex})">
                                ${q.selected ? '‚úì Selected' : '+ Add Back'}
                            </button>
                        </div>
                    `;
                    categoryDiv.appendChild(questionDiv);
                });

                container.appendChild(categoryDiv);
            });
        }

        function toggleQuestion(catIndex, qIndex) {
            generatedQuestions[catIndex].questions[qIndex].selected =
                !generatedQuestions[catIndex].questions[qIndex].selected;
            displayQuestions();
        }

        // SCREEN 3: Live Interview Mode
        async function startLiveMode() {
            // Start interview session on backend
            await fetch('/start-interview', { method: 'POST' });
            showScreen('screen-interview');
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

                // Get Deepgram API key
                const keyResponse = await fetch('/deepgram-key');
                const keyData = await keyResponse.json();

                if (!keyData.api_key) {
                    alert('Deepgram API key not configured');
                    return;
                }

                // Connect to Deepgram
                const deepgramUrl = `wss://api.deepgram.com/v1/listen?encoding=linear16&sample_rate=16000&channels=1`;
                deepgramSocket = new WebSocket(deepgramUrl, ['token', keyData.api_key]);

                deepgramSocket.onopen = () => {
                    console.log('Connected to Deepgram');
                    updateStatus('üé§ Recording...', true);
                    isRecording = true;
                    document.getElementById('record-btn').disabled = true;
                    document.getElementById('stop-btn').disabled = false;
                };

                deepgramSocket.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    if (data.channel && data.channel.alternatives && data.channel.alternatives[0]) {
                        const transcript = data.channel.alternatives[0].transcript;
                        if (transcript && data.is_final) {
                            addTranscript(transcript, 'Participant');
                            sendTranscriptToBackend(transcript, 'Participant');
                        }
                    }
                };

                deepgramSocket.onerror = (error) => {
                    console.error('Deepgram error:', error);
                    updateStatus('‚ö†Ô∏è Connection error', false);
                };

                // Setup audio processing
                audioContext = new AudioContext({ sampleRate: 16000 });
                const source = audioContext.createMediaStreamSource(stream);
                const processor = audioContext.createScriptProcessor(4096, 1, 1);

                processor.onaudioprocess = (e) => {
                    if (deepgramSocket && deepgramSocket.readyState === WebSocket.OPEN) {
                        const inputData = e.inputBuffer.getChannelData(0);
                        const pcm16 = floatTo16BitPCM(inputData);
                        deepgramSocket.send(pcm16);
                    }
                };

                source.connect(processor);
                processor.connect(audioContext.destination);

            } catch (error) {
                console.error('Error starting recording:', error);
                alert('Error accessing microphone: ' + error.message);
            }
        }

        function stopRecording() {
            if (deepgramSocket) {
                deepgramSocket.close();
                deepgramSocket = null;
            }
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
            isRecording = false;
            updateStatus('‚è∏Ô∏è Not Recording', false);
            document.getElementById('record-btn').disabled = false;
            document.getElementById('stop-btn').disabled = true;
        }

        function floatTo16BitPCM(float32Array) {
            const buffer = new ArrayBuffer(float32Array.length * 2);
            const view = new DataView(buffer);
            for (let i = 0; i < float32Array.length; i++) {
                const s = Math.max(-1, Math.min(1, float32Array[i]));
                view.setInt16(i * 2, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
            }
            return buffer;
        }

        function updateStatus(text, isActive) {
            const statusEl = document.getElementById('listening-status');
            statusEl.textContent = text;
            statusEl.className = 'status-indicator ' + (isActive ? 'status-active' : 'status-inactive');
        }

        function addTranscript(text, speaker) {
            const box = document.getElementById('transcript-box');
            if (box.querySelector('p')) {
                box.innerHTML = '';
            }

            const entry = document.createElement('div');
            entry.className = 'transcript-entry';
            entry.innerHTML = `
                <div class="transcript-speaker">${speaker}</div>
                <div class="transcript-text">${text}</div>
            `;
            box.appendChild(entry);
            box.scrollTop = box.scrollHeight;
        }

        async function sendTranscriptToBackend(text, speaker) {
            await fetch('/transcript', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text, speaker })
            });
        }

        async function getSuggestions() {
            try {
                const response = await fetch('/suggestions');
                const data = await response.json();

                const box = document.getElementById('suggestions-box');
                box.innerHTML = '';

                data.questions.forEach(q => {
                    const div = document.createElement('div');
                    div.className = 'suggestion';
                    div.textContent = q;
                    div.onclick = () => {
                        addTranscript(q, 'Interviewer');
                        sendTranscriptToBackend(q, 'Interviewer');
                    };
                    box.appendChild(div);
                });
            } catch (error) {
                console.error('Error getting suggestions:', error);
            }
        }

        // SCREEN 4: End Interview & Show Summary
        async function endInterview() {
            if (isRecording) {
                stopRecording();
            }

            showScreen('screen-summary');

            try {
                const response = await fetch('/end-interview', { method: 'POST' });
                interviewData = await response.json();

                displaySummary(interviewData.qa_data);
                document.getElementById('create-report-btn').disabled = false;

            } catch (error) {
                console.error('Error ending interview:', error);
                document.getElementById('summary-container').innerHTML =
                    '<p style="color: #ef4444;">Error processing interview data.</p>';
            }
        }

        function displaySummary(qaData) {
            const container = document.getElementById('summary-container');
            container.innerHTML = '';
            container.classList.remove('loading');

            if (!qaData || qaData.length === 0) {
                container.innerHTML = '<p style="color: #666;">No Q&A data available.</p>';
                return;
            }

            qaData.forEach(qa => {
                const qaDiv = document.createElement('div');
                qaDiv.className = 'qa-item';

                let insightsHTML = '';
                if (qa.key_insights && qa.key_insights.length > 0) {
                    insightsHTML = `
                        <div class="insights-tags">
                            ${qa.key_insights.map(insight =>
                                `<span class="insight-tag">${insight}</span>`
                            ).join('')}
                        </div>
                    `;
                }

                qaDiv.innerHTML = `
                    <div class="qa-question">Q: ${qa.question}</div>
                    <div class="qa-answer">A: ${qa.answer}</div>
                    <span class="qa-category">${qa.category}</span>
                    ${insightsHTML}
                `;
                container.appendChild(qaDiv);
            });
        }

        function backToInterview() {
            showScreen('screen-interview');
        }

        // SCREEN 5: Generate Report
        async function generateReport() {
            showScreen('screen-report');
            document.getElementById('report-container').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Generating comprehensive research report...</p>
                </div>
            `;

            try {
                const response = await fetch('/generate-report', { method: 'POST' });
                reportData = await response.json();

                displayReport(reportData.report);

            } catch (error) {
                console.error('Error generating report:', error);
                document.getElementById('report-container').innerHTML =
                    '<p style="color: #ef4444;">Error generating report.</p>';
            }
        }

        function displayReport(reportMarkdown) {
            const container = document.getElementById('report-container');
            container.classList.remove('loading');

            // Debug: Check for markdown images
            const markdownImages = reportMarkdown.match(/!\[(.*?)\]\((.*?)\)/g);
            console.log('üñºÔ∏è Markdown images found:', markdownImages ? markdownImages.length : 0);
            if (markdownImages) {
                markdownImages.forEach((img, i) => console.log(`  Image ${i+1}: ${img.substring(0, 80)}...`));
            }

            // Simple markdown to HTML conversion
            let html = reportMarkdown
                // Convert images FIRST before other replacements
                .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" style="max-width: 100%; height: auto; border-radius: 12px; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" />')
                .replace(/## (.*)/g, '<h2>$1</h2>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/^- (.*)/gm, '<li>$1</li>')
                .replace(/^> (.*)/gm, '<blockquote>$1</blockquote>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^(?!<[h|l|b|i])/gm, '<p>')
                .replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>');

            container.innerHTML = `<div class="report-content">${html}</div>`;

            // Debug: Check how many img tags were created
            const imgTags = container.querySelectorAll('img');
            console.log('‚úÖ Image tags rendered:', imgTags.length);
            imgTags.forEach((img, i) => {
                console.log(`  Image ${i+1} src:`, img.src.substring(0, 80) + '...');
            });
        }

        function downloadReport() {
            if (!reportData) return;

            const blob = new Blob([reportData.report], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `research-report-${new Date().toISOString().split('T')[0]}.md`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function startNewInterview() {
            // Reset everything
            generatedQuestions = [];
            interviewData = null;
            reportData = null;
            document.getElementById('product-description').value = '';
            document.getElementById('research-goals').value = '';
            document.getElementById('transcript-box').innerHTML =
                '<p style="color: #666; text-align: center; padding: 40px;">Transcript will appear here once recording starts...</p>';
            document.getElementById('suggestions-box').innerHTML =
                '<p style="color: #666;">Click "Generate Questions" to get AI suggestions</p>';

            showScreen('screen-landing');
        }

        // Auto-refresh suggestions during interview
        setInterval(() => {
            if (currentScreen === 'screen-interview' && isRecording) {
                getSuggestions();
            }
        }, 15000); // Every 15 seconds
    </script>
</body>
</html>
